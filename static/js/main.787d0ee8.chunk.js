(this.webpackJsonpcorona=this.webpackJsonpcorona||[]).push([[0],{116:function(t,e,i){t.exports=i(206)},121:function(t,e,i){},139:function(t,e,i){},206:function(t,e,i){"use strict";i.r(e);var a=i(0),n=i.n(a),r=i(4),l=i.n(r),o=(i(121),i(6)),s=i(7),c=i(24),u=i(20),d=i(25),h=i(21),m=i(22),f=i(2),p=i(15),v=i.n(p),y=i(23);function g(){var t=Object(h.a)(["\n    width: 100%;\n    max-width: 600px;\n    margin: 0 36px;\n    position: relative;\n    border-radius: 8px;\n\n\n    h3 {\n        text-align: center;\n        position: relative;\n        left: 60px;\n        color: #ccc;\n        cursor: default;\n        margin: 0;\n    }\n\n    .slick-prev:before, .slick-next:before {\n        color: #aaa;\n    }\n\n    .slick-prev {\n        left: 4px;\n        z-index: 2;\n    }\n\n    .slick-next {\n        z-index: 2;\n        right: -12px;\n    }\n\n    .slick-dots {\n        bottom: 0px;\n        right: -40px;\n    }\n\n    .slick-dots li button:before {\n        color: white;\n    }\n"]);return g=function(){return t},t}var b=y.a.div(g()),x=i(11),w=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,r=n.a.useState(0),l=Object(x.a)(r,2),o=l[0],s=l[1],c=n.a.useState([]),u=Object(x.a)(c,2),d=u[0],h=u[1],m=n.a.useState(1),f=Object(x.a)(m,2),p=f[0],v=f[1];return n.a.useEffect((function(){var n,r=d;if(t.length>o){if(t.length<o+2*p)return;n=t.slice(o).filter((function(t,e){return e%p===0}))}else r=[],n=t;r.length>a&&(v(2*p),r=r.filter((function(t,e){return Math.floor(e/i)%2===0}))),e.source(n),h(r.concat(e.rows)),s(t.length)}),[t,t.length]),d},k=(new v.a.View).transform({type:"map",callback:function(t){return Object(m.a)({},t.population,{time:t.datetime.day+Math.floor(t.datetime.scene/3*10)/10})}}).transform({type:"fold",fields:["susceptible","incubating","latentlyInfactious","exposedInfactious","serious","dead","recovered"],key:"state",value:"value",retains:["time"]}),S=function(t){var e=t.agg,i=w(e,k,7);return n.a.createElement(b,null,n.a.createElement("h3",null,"Ill State Distribution"),n.a.createElement(f.Chart,{data:i,forceFit:!0,height:220,padding:[20,40,40,180]},n.a.createElement(f.Axis,{name:"time"}),n.a.createElement(f.Axis,{name:"value"}),n.a.createElement(f.Legend,{position:"left"}),n.a.createElement(f.Tooltip,{crosshairs:{type:"cross"}}),n.a.createElement(f.Geom,{type:"areaStack",position:"time*value",color:"state",opacity:.3}),n.a.createElement(f.Geom,{type:"lineStack",position:"time*value",size:2,color:"state"})))},P=i(96),R=i.n(P),E=(new v.a.View).transform({type:"map",callback:function(t){return Object(m.a)({},t.districtDistribution,{},t.datetime)}}).transform({type:"fold",fields:["medicalBed","living","work","publicTransport","hospital","facility","cemetery"],key:"state",value:"value",retains:["day","scene"]}),O=function(t){var e=t.agg,i=w(e,E,7),a=n.a.useMemo((function(){for(var t=[],e=function(e){var a=(new v.a.View).source(i).transform({type:"filter",callback:function(t){return t.scene===e}});t.push(n.a.createElement(f.Chart,{height:220,padding:[20,40,40,180],data:a,forceFit:!0,key:e},n.a.createElement(f.Axis,{name:"day"}),n.a.createElement(f.Axis,{name:"value"}),n.a.createElement(f.Legend,{position:"left"}),n.a.createElement(f.Tooltip,{crosshairs:{type:"cross"}}),n.a.createElement(f.Geom,{type:"areaStack",position:"day*value",color:"state"}),n.a.createElement(f.Geom,{type:"lineStack",position:"day*value",size:2,color:"state"})))},a=0;a<3;a++)e(a);return t}),[i]);return n.a.createElement(b,{style:{padding:"0 12px 12px 12px"}},n.a.createElement("h3",null,"Disctrict Distribution (",3," Scenes)"),n.a.createElement(R.a,{dots:!0,infinite:!0,speed:300,slidesToScroll:1,slidesToShow:1,arrows:!0},a))},I=(new v.a.View).transform({type:"map",callback:function(t){return Object(m.a)({},t.quarantined,{time:t.datetime.day+Math.floor(t.datetime.scene/3*10)/10})}}).transform({type:"fold",fields:["confirmed","suspected"],key:"state",value:"value",retains:["time"]}),A=function(t){var e=t.agg,i=w(e,I,2);return n.a.createElement(b,null,n.a.createElement("h3",null,"Patients"),n.a.createElement(f.Chart,{height:220,padding:[20,40,40,180],data:i,forceFit:!0},n.a.createElement(f.Axis,{name:"time"}),n.a.createElement(f.Axis,{name:"value"}),n.a.createElement(f.Legend,{position:"left-center"}),n.a.createElement(f.Tooltip,{crosshairs:{type:"y"}}),n.a.createElement(f.Geom,{type:"line",position:"time*value",color:"state",size:2})))},j=(new v.a.View).transform({type:"map",callback:function(t){return{R0:t.R0,time:t.datetime.day+Math.floor(t.datetime.scene/3*10)/10}}}),M=function(t){var e=t.agg,i=w(e,j);return n.a.createElement(b,null,n.a.createElement("h3",null,"R0"),n.a.createElement(f.Chart,{height:220,padding:[20,40,40,180],data:i,forceFit:!0},n.a.createElement(f.Axis,{name:"time"}),n.a.createElement(f.Axis,{name:"value"}),n.a.createElement(f.Tooltip,{crosshairs:{type:"y"}}),n.a.createElement(f.Geom,{type:"line",position:"time*R0",size:2})))},D=i(37),H=function(){function t(e,i,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"rgba(100, 200, 230, 0.5)",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";Object(o.a)(this,t),this.district=e,this.bbox=i,this.ctx=a,this.name=n,this.fill=r,this.stroke=l,this.placeBoundingBoxes=void 0,this.init()}return Object(s.a)(t,[{key:"init",value:function(){this.placeBoundingBoxes=[];for(var t=6,e=0,i=0;i<this.district.places.length;i++)t+6+6>this.bbox.w&&(t=6,e+=22),this.placeBoundingBoxes.push({h:10,w:6,x:t+this.bbox.x,y:e+this.bbox.y+40}),t+=18}},{key:"draw",value:function(){this.ctx.save(),this.ctx.fillStyle=this.fill,this.ctx.strokeStyle=this.stroke,this.ctx.fillRect(this.bbox.x,this.bbox.y,this.bbox.w,this.bbox.h),this.ctx.strokeStyle="",this.ctx.fillStyle="#bbb",this.ctx.font="12px Fira Code",this.ctx.fillText(this.name,this.bbox.x+10,this.bbox.y+20),this.ctx.restore()}},{key:"getPlaceBBox",value:function(t){return this.placeBoundingBoxes[t]}}]),t}(),C=["blue","#ddd","yellow","#fa6","faa","#a22","black"],B=function(){function t(e,i,a){Object(o.a)(this,t),this.ctx=e,this.districts=a,this.individuals=void 0,this.positions=void 0,this.individuals=i.concat(),this.positions=this.getCurrentPosition()}return Object(s.a)(t,[{key:"draw",value:function(){this.ctx.save(),this.ctx.globalAlpha=.6;for(var t=0;t<this.individuals.length;t++){var e=this.individuals[t];this.ctx.fillStyle=C[e.illState],this.ctx.beginPath(),this.ctx.arc(this.positions[t].x,this.positions[t].y,2,0,2*Math.PI),this.ctx.closePath(),this.ctx.fill()}this.ctx.restore()}},{key:"getCurrentPosition",value:function(){var t=[],e=!0,i=!1,a=void 0;try{for(var n,r=this.individuals[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var l=n.value.currentPlace,o=l.index,s=l.district,c=this.districts[s.name].getPlaceBBox(o),u=c.x,d=c.y,h=c.w,m=c.h;t.push({x:u+Math.floor(h*Math.random()),y:d+Math.floor(m*Math.random())})}}catch(f){i=!0,a=f}finally{try{e||null==r.return||r.return()}finally{if(i)throw a}}return t}},{key:"getTweenGroup",value:function(){for(var t=new D.a.Group,e=this.getCurrentPosition(),i=0;i<this.individuals.length;i++)new D.a.Tween(this.positions[i],t).to(e[i],1e3).start();return t}}]),t}();function F(){var t=Object(h.a)(["\n    min-width: 700px;\n    min-height: 600px;\n    position: relative;\n"]);return F=function(){return t},t}var T,q,W=y.a.div(F()),L=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).datetime=void 0,i.canvas=void 0,i.ctx=void 0,i.districts=void 0,i.individuals=void 0,i.endTime=void 0,i.animationKey=void 0,i.world=void 0,i.test=function(){var t=[{x:0},{x:100}],e=new D.a.Group;new D.a.Tween(t,e).to([{x:100},{x:0}],2e3).onUpdate((function(e){console.log(e,t)})).start(),requestAnimationFrame((function t(){requestAnimationFrame(t),e.update()}))},i.canvas=n.a.createRef(),i.world=i.props.world,i}return Object(d.a)(e,t),Object(s.a)(e,[{key:"updateWorld",value:function(){this.world!==this.props.world&&(this.world=this.props.world,this.init())}},{key:"componentDidMount",value:function(){this.canvas.current&&(this.ctx=this.canvas.current.getContext("2d"),this.init())}},{key:"init",value:function(){this.districts={facility:new H(this.world.districts.facility,{x:200,y:80,h:180,w:180},this.ctx,"Facility","rgba(0, 255, 255, 0.08)"),hospital:new H(this.world.districts.hospital,{x:200,y:280,h:200,w:180},this.ctx,"Hospital","rgba(0, 255, 255, 0.08)"),work:new H(this.world.districts.work,{x:400,y:0,h:480,w:300},this.ctx,"Work","rgba(0, 255, 255, 0.08)"),publicTransport:new H(this.world.districts.publicTransport,{x:200,y:0,h:60,w:180},this.ctx,"Public Transport","rgba(0, 255, 255, 0.08)"),living:new H(this.world.districts.living,{x:0,y:0,h:480,w:180},this.ctx,"Residential Area","rgba(0, 255, 255, 0.08)"),medicalBed:new H(this.world.districts.medicalBed,{x:0,y:500,h:100,w:580},this.ctx,"Quarantine Area","rgba(0, 255, 255, 0.08)"),cemetery:new H(this.world.districts.cemetery,{x:600,y:500,h:100,w:100},this.ctx,"Cemetery","rgba(0, 255, 255, 0.08)")},this.individuals=new B(this.ctx,this.world.individuals,this.districts),this.animationKey=0,this.draw(0)}},{key:"draw",value:function(t,e){var i=this;if(this.ctx){for(var a in this.updateWorld(),this.ctx.save(),this.ctx.translate(10,10),this.ctx.scale(.95*3,.95*3),this.ctx.clearRect(0,0,800,800),this.districts){this.districts[a].draw()}this.individuals.draw(),this.ctx.restore(),e&&e.update(),t===this.animationKey&&this.endTime&&(new Date).getTime()<this.endTime&&requestAnimationFrame((function(){return i.draw(t,e)}))}}},{key:"step",value:function(){this.updateWorld();var t=this.individuals.getTweenGroup();this.endTime=(new Date).getTime()+2e3,this.animationKey=Math.random(),this.draw(this.animationKey,t)}},{key:"render",value:function(){return n.a.createElement(W,null,n.a.createElement("canvas",{width:2100,height:1800,ref:this.canvas,style:{width:700,height:600}}))}}]),e}(n.a.Component),z=i(213),G=i(214),N=i(215),Q=i(216),V=i(210),J=i(211),K=i(41),U=i(50),$={plotBackground:{fill:"rgb(25, 23, 44)"},animation:!0,axis:{top:{label:{textStyle:{fill:"#A6A6A6"}},line:{stroke:"#737373"},tickLine:{stroke:"#737373"}},bottom:{label:{textStyle:{fill:"#A6A6A6"}},line:{stroke:"#737373"},tickLine:{stroke:"#737373"}},left:{label:{textStyle:{fill:"#A6A6A6"}},grid:{lineStyle:{stroke:"#404040"}}},right:{label:{textStyle:{fill:"#A6A6A6"}},grid:{lineStyle:{stroke:"#404040"}}},circle:{label:{textStyle:{fill:"#A6A6A6"}},line:{stroke:"#737373"},tickLine:{stroke:"#737373"},grid:{lineStyle:{stroke:"#404040"}}},radius:{label:{textStyle:{fill:"#A6A6A6"}},line:{stroke:"#737373"},tickLine:{stroke:"#737373"},grid:{lineStyle:{stroke:"#404040"}}},helix:{line:{stroke:"#737373"},tickLine:{stroke:"#737373"}}},label:{textStyle:{fill:"#A6A6A6"}},legend:{right:{textStyle:{fill:"#737373"},unCheckColor:"#bfbfbf"},left:{textStyle:{fill:"#737373"},unCheckColor:"#bfbfbf"},top:{textStyle:{fill:"#737373"},unCheckColor:"#bfbfbf"},bottom:{textStyle:{fill:"#737373"},unCheckColor:"#bfbfbf"},html:{"g2-legend":{color:"#D9D9D9"}},gradient:{textStyle:{fill:"#D9D9D9"},lineStyle:{stroke:"#404040"}}},tooltip:Object(U.a)({},"g2-tooltip",{color:"#D9D9D9",backgroundColor:"rgba(0, 0, 0, 0.5)",boxShadow:"0px 0px 2px #000"}),tooltipCrosshairsRect:{type:"rect",rectStyle:{fill:"#fff",opacity:.1}},tooltipCrosshairsLine:{lineStyle:{stroke:"rgba(255, 255, 255, 0.45)"}},guide:{line:{text:{style:{fill:"#A6A6A6"}}},text:{style:{fill:"#A6A6A6"}},region:{style:{lineWidth:0,fill:"#000",fillOpacity:.04}}}},X={disease:{cureRate:1/3/30/50,deadRate:1/3/30/100,immuneRate:0,infectiousRate:.02,name:"virus",selfRecoverRate:0,seriousRate:1/3/50,toExposedInfactiousRate:1/3/500,toLatentlyInfactiousRate:1/3/4},family:{familyPopulationDistribution:[[60,2],[75,4],[30,8],[15,16]],partyRate:.05},medicine:{confirmRate:.05,cureRateInHospital:2e-4,cureRateOnMedicalBed:4e-4,deteriorateFactorOnMedicalBed:.5,visitingHospitalRate:.005,doctorNum:10,infactiousRateBetweenDoctorAndPatient:2e-5,infactiousRateBetweenPatients:1e-4,medicalBedNumber:4},individual:{goOutRateWhenQuarantedAtHome:.01,visitingHospitalRateWhenExposed:.02},numberOfScenePerDay:3,init:{origin:"cemetery",initialSize:4},region:{densityOfPopulation:10,doPeriodicPhysicalExamination:!0,facilityActiveRate:10,privateCarRate:.2,unemploymentRate:.07}};!function(t){t[t.recovered=0]="recovered",t[t.susceptible=1]="susceptible",t[t.incubating=2]="incubating",t[t.latentlyInfactious=3]="latentlyInfactious",t[t.exposedInfactious=4]="exposedInfactious",t[t.serious=5]="serious",t[t.dead=6]="dead"}(T||(T={})),function(t){t[t.none=0]="none",t[t.atHome=1]="atHome",t[t.atHospital=2]="atHospital"}(q||(q={}));var Y=function(){function t(e){Object(o.a)(this,t),this.host=e,this.from=void 0,this.to=void 0}return Object(s.a)(t,[{key:"infect",value:function(t){null==this.to?this.to=[t]:this.to.push(t),t.illRelation.from=this.host}}]),t}(),Z=function(){function t(e){Object(o.a)(this,t),this.currentPlace=void 0,this.illRelation=new Y(this),this.illState=void 0,this.hasCar=void 0,this.visitingHospitalRate=void 0,this.wearMask=void 0,this.home=void 0,this.workPlace=void 0,this.param=void 0,this.hospitalPlace=void 0,this.targetingFacilityPlaces=void 0,this.treatmentState=void 0,this.isDoctor=void 0,this.estimatedR0=void 0,this.isDoctor=e.isDoctor,this.illState=e.illState,this.hasCar=e.hasCar,this.visitingHospitalRate=e.visitingHospitalRate,this.wearMask=e.wearMask,this.home=e.home,this.workPlace=e.workPlace,this.hospitalPlace=e.hospitalPlace,this.targetingFacilityPlaces=e.targetingFacilityPlaces,this.currentPlace=e.currentPlace,this.treatmentState=e.treatmentState,this.param=e.param}return Object(s.a)(t,[{key:"postInfect",value:function(t){this.illRelation.infect(t)}},{key:"preGoto",value:function(t){this.hasCar||this.isQuarantined||this.beInPlace(t.nextAvailablePlace())}},{key:"beInPlace",value:function(t){this.currentPlace.remove(this),this.currentPlace=t,t.push(this)}},{key:"gotoWork",value:function(t){this.cannotMoveAtAll||(this.treatmentState.quanrantine!==q.atHome?this.isDoctor?this.beInPlace(this.workPlace):this.workPlace&&this.beInPlace(this.workPlace):t.hospital.isFull||this.beInPlace(t.hospital.nextAvailablePlace()))}},{key:"gotoFacility",value:function(){if(!this.cannotMoveAtAll&&!this.isQuarantined&&this.targetingFacilityPlaces.length>=1){for(var t=Math.floor(Math.random()*this.targetingFacilityPlaces.length),e=0;this.targetingFacilityPlaces[t].isFull&&e<this.targetingFacilityPlaces.length;)t=(t+1)%this.targetingFacilityPlaces.length,e++;e!==this.targetingFacilityPlaces.length&&this.beInPlace(this.targetingFacilityPlaces[t])}}},{key:"goHome",value:function(){this.cannotMoveAtAll||this.beInPlace(this.home)}},{key:"gotoHospital",value:function(t){this.cannotMoveAtAll||this.beInPlace(t.nextAvailablePlace())}},{key:"goRandomPlace",value:function(t){this.cannotMoveAtAll||(t.hospital.isFull||this.treatmentState.quanrantine!==q.atHome?!t.hospital.isFull&&Math.random()<this.visitingHospitalRate?this.gotoHospital(t.hospital):this.isQuarantined?this.treatmentState.quanrantine===q.atHome&&Math.random()<this.param.goOutRateWhenQuarantedAtHome&&this.gotoFacility():this.gotoFacility():this.gotoHospital(t.hospital))}},{key:"upgrade",value:function(t,e){var i=1;this.treatmentState.quanrantine===q.atHospital&&(i=e.deteriorateFactorOnMedicalBed),this.illState=function(t,e,i){if(t<=T.susceptible)return t;if(t===T.incubating){if(Math.random()<e.toLatentlyInfactiousRate*i)return T.latentlyInfactious}else if(t===T.latentlyInfactious){if(Math.random()<e.toExposedInfactiousRate*i)return T.exposedInfactious}else if(t===T.exposedInfactious){if(Math.random()<e.seriousRate*i)return T.serious}else if(t===T.serious&&Math.random()<e.deadRate*i)return T.dead;return Math.random()<e.selfRecoverRate?T.recovered:t}(this.illState,t,i),this.illState===T.serious?this.treatmentState.quanrantine<=q.atHome&&(this.treatmentState.quanrantine=q.atHome,this.visitingHospitalRate=1):this.illState===T.exposedInfactious&&(this.visitingHospitalRate=this.param.visitingHospitalRateWhenExposed)}},{key:"isQuarantined",get:function(){return this.treatmentState.quanrantine>0||this.illState===T.dead}},{key:"isDead",get:function(){return this.illState===T.dead}},{key:"cannotMoveAtAll",get:function(){return this.treatmentState.quanrantine===q.atHospital||this.illState===T.dead}},{key:"isWorking",get:function(){return this.illState<=T.latentlyInfactious}}]),t}(),_=i(49),tt=function(){function t(e,i,a){Object(o.a)(this,t),this.index=e,this.district=i,this.max=a,this.people=void 0,this.people=new Set}return Object(s.a)(t,[{key:"push",value:function(t){this.people.add(t)}},{key:"merge",value:function(t){for(var e=t.people.values(),i=null;null!=(i=e.next().value);)i.beInPlace(this),this.people.add(i);t.people.clear()}},{key:"remove",value:function(t){this.people.delete(t)}},{key:"clear",value:function(){this.people.clear()}},{key:"mapPeople",value:function(t){this.people.forEach(t)}},{key:"length",get:function(){return this.people.size}},{key:"isFull",get:function(){return this.people.size>=this.max}}]),t}(),et=function(){function t(e,i,a){var n=this;Object(o.a)(this,t),this.name=e,this.places=void 0,this.maxPopulation=void 0,this.availableIndex=0,this.nextAvailablePlace=function(){if(n.isFull)throw new Error;return n.places[n.availableIndex]},this.randomPlace=function(){return n.places[Math.floor(Math.random()*n.places.length)]},this.places=[];for(var r=0;r<i;r++)this.places.push(new tt(r,this,a));this.maxPopulation=a*i}return Object(s.a)(t,[{key:"mapPeople",value:function(t){var e=!0,i=!1,a=void 0;try{for(var n,r=this.places[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){n.value.mapPeople(t)}}catch(l){i=!0,a=l}finally{try{e||null==r.return||r.return()}finally{if(i)throw a}}}},{key:"beforeSceneStart",value:function(){this.availableIndex=0}},{key:"isFull",get:function(){for(;this.places.length>this.availableIndex&&this.places[this.availableIndex].isFull;)this.availableIndex++;return this.availableIndex>=this.places.length}},{key:"population",get:function(){var t=0,e=!0,i=!1,a=void 0;try{for(var n,r=this.places[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){t+=n.value.people.size}}catch(l){i=!0,a=l}finally{try{e||null==r.return||r.return()}finally{if(i)throw a}}return t}}]),t}(),it=function(t){function e(t){var i;Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,"living",0,0))).name="living",i.fillIndex=0;var a=0,n=!0,r=!1,l=void 0;try{for(var s,d=t[Symbol.iterator]();!(n=(s=d.next()).done);n=!0)for(var h=Object(x.a)(s.value,2),m=h[0],f=h[1],p=0;p<m;p++)i.places.push(new tt(a,Object(_.a)(i),f)),a++}catch(v){r=!0,l=v}finally{try{n||null==d.return||d.return()}finally{if(r)throw l}}return i}return Object(d.a)(e,t),Object(s.a)(e,[{key:"nextFillingPlace",value:function(){return this.places[this.fillIndex].isFull&&this.fillIndex++,this.places[this.fillIndex]}}]),e}(et),at=function(t){function e(t,i,a,n){var r;return Object(o.a)(this,e),(r=Object(c.a)(this,Object(u.a)(e).call(this,"hospital",a,n))).param=t,r.medicalBed=i,r.name="hospital",r.doctors=[],r.examPerson=function(t){t.treatmentState.isConfirmed?(t.treatmentState.quanrantine===q.atHospital?Math.random()<r.param.cureRateOnMedicalBed&&(t.illState=T.recovered):Math.random()<r.param.cureRateInHospital&&(t.illState=T.recovered),t.illState===T.recovered&&(t.treatmentState={isConfirmed:!1,isSuspected:!1,quanrantine:q.none},t.visitingHospitalRate=r.param.visitingHospitalRate,t.goHome())):t.treatmentState.isSuspected&&Math.random()<r.param.confirmRate&&(t.treatmentState.isConfirmed=!0),t.illState>=T.exposedInfactious&&t.currentPlace.district!==r.medicalBed&&(t.treatmentState.isSuspected=!0,t.visitingHospitalRate=1,r.hospitalize(t))},r}return Object(d.a)(e,t),Object(s.a)(e,[{key:"exam",value:function(){this.mapPeople(this.examPerson),this.medicalBed.mapPeople(this.examPerson)}},{key:"hospitalize",value:function(t){this.medicalBed.isFull?t.treatmentState.quanrantine=q.atHome:(t.treatmentState.quanrantine=q.atHospital,t.beInPlace(this.medicalBed.nextAvailablePlace()))}},{key:"isFull",get:function(){for(;this.availableIndex<this.places.length;)if(this.doctors[this.availableIndex].isWorking){if(!this.places[this.availableIndex].isFull)break;this.availableIndex++}else this.availableIndex++;return this.availableIndex>=this.places.length}}]),e}(et),nt=function(){function t(e){Object(o.a)(this,t),this.param=e,this.aggData=[],this.disease=void 0,this.districts=void 0,this.datetime=void 0,this.numberOfScenePerDay=void 0,this.individuals=void 0,this.population=0,this.postSceneListeners=[],this.numberOfScenePerDay=e.numberOfScenePerDay,this.disease=e.disease,this.individuals=[];var i=!0,a=!1,n=void 0;try{for(var r,l=e.family.familyPopulationDistribution[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var s=Object(x.a)(r.value,2),c=s[0],u=s[1];this.population+=c*u}}catch(w){a=!0,n=w}finally{try{i||null==l.return||l.return()}finally{if(a)throw n}}var d=new et("medicalBed",e.medicine.medicalBedNumber,1);this.districts={medicalBed:d,living:new it(e.family.familyPopulationDistribution),publicTransport:new et("publicTransport",this.population/30,30),hospital:new at(e.medicine,d,e.medicine.doctorNum,20),facility:new et("facility",this.population/20,20),work:new et("work",this.population/10,10),cemetery:new et("cemetery",1,5e4)};for(var h=0;h<this.population;h++){var m=this.districts.living.nextFillingPlace(),f=Math.random()<e.region.privateCarRate,p=new Z({workPlace:void 0,isDoctor:!1,param:e.individual,currentPlace:m,home:m,hasCar:f,illState:T.susceptible,targetingFacilityPlaces:Array(e.region.facilityActiveRate).fill(0).map(this.districts.facility.randomPlace),visitingHospitalRate:this.param.medicine.visitingHospitalRate,wearMask:!1,hospitalPlace:void 0,treatmentState:{isConfirmed:!1,quanrantine:q.none,isSuspected:!1}});m.push(p),this.individuals.push(p)}this.randomizeIndivisuals();for(var v=0;v<this.population;v++){var y=Math.random()<e.region.unemploymentRate?void 0:this.districts.work.nextAvailablePlace();this.individuals[v].workPlace=y,y&&y.push(this.individuals[v])}this.districts.work.places.forEach((function(t){return t.clear()})),this.randomizeIndivisuals();for(var g=e.medicine.doctorNum,b=0;b<g;b++)this.individuals[b].isDoctor=!0,this.individuals[b].workPlace=this.districts.hospital.places[b],this.districts.hospital.doctors.push(this.individuals[b]);this.datetime={day:0,scene:0}}return Object(s.a)(t,[{key:"start",value:function(){this.randomizeIndivisuals();for(var t=0;t<this.param.init.initialSize;t++)this.individuals[t].illState=T.incubating}},{key:"goToWork",value:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=this.individuals[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){a.value.gotoWork(this.districts)}}catch(r){e=!0,i=r}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"setPostSceneListener",value:function(t){this.postSceneListeners.push(t)}},{key:"party",value:function(){for(var t=this.districts.living.places,e=0;e<t.length;e++)if(0!==t[e].length&&Math.random()<this.param.family.partyRate){var i=(e+Math.floor(10*Math.random())+1)%this.districts.living.places.length;t[e].merge(t[i])}}},{key:"callItADay",value:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=this.individuals[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){a.value.goHome()}}catch(r){e=!0,i=r}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}this.party()}},{key:"goRandomPlace",value:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=this.individuals[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){a.value.goRandomPlace(this.districts)}}catch(r){e=!0,i=r}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"infectOther",value:function(t,e,i){if(t.illState>1){var a=this.param.disease.infectiousRate;i&&(a=(t.isDoctor,this.param.medicine.infactiousRateBetweenDoctorAndPatient));for(var n=e.values(),r=null;r=n.next().value;)r.illState===T.susceptible&&(i&&r.isDoctor&&(a=this.param.medicine.infactiousRateBetweenDoctorAndPatient),Math.random()<a&&(r.illState=T.incubating,t.postInfect(r)))}}},{key:"infect",value:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=this.individuals[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var r=a.value;r.isDead||this.infectOther(r,r.currentPlace.people,r.currentPlace.district===this.districts.hospital||r.currentPlace.district===this.districts.medicalBed)}}catch(l){e=!0,i=l}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"upgradeDisease",value:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=this.individuals[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var r=a.value;r.upgrade(this.param.disease,this.param.medicine),r.illState===T.dead&&r.beInPlace(this.districts.cemetery.places[0])}}catch(l){e=!0,i=l}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"preMove",value:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=this.individuals[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){a.value.preGoto(this.districts.publicTransport)}}catch(r){e=!0,i=r}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"setTimeToNextScene",value:function(){this.datetime.scene++,this.datetime.scene===this.numberOfScenePerDay&&(this.datetime.day++,this.datetime.scene=0)}},{key:"beforeSceneStart",value:function(){var t=!0,e=!1,i=void 0;try{for(var a,n=Object.values(this.districts)[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){a.value.beforeSceneStart()}}catch(r){e=!0,i=r}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"step",value:function(){this.upgradeDisease(),this.beforeSceneStart(),this.preMove(),this.infect(),0===this.datetime.scene?this.goToWork():this.datetime.scene===this.numberOfScenePerDay-1?this.callItADay():this.goRandomPlace(),this.districts.hospital.exam(),this.infect(),this.setTimeToNextScene(),this.randomizeIndivisuals(),this.aggData.push(this.aggregateInfo);var t=!0,e=!1,i=void 0;try{for(var a,n=this.postSceneListeners[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){(0,a.value)(this)}}catch(r){e=!0,i=r}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"isEnd",value:function(){var t=this.aggregateInfo;return t.population.exposedInfactious+t.population.latentlyInfactious+t.population.serious+t.population.incubating===0}},{key:"randomizeIndivisuals",value:function(){for(var t=0;t<this.individuals.length;t++){var e=Math.floor(Math.random()*this.individuals.length),i=[this.individuals[e],this.individuals[t]];this.individuals[t]=i[0],this.individuals[e]=i[1]}}},{key:"aggregateInfo",get:function(){var t={districtDistribution:{medicalBed:0,cemetery:0,facility:0,hospital:0,living:0,publicTransport:0,work:0},population:{dead:0,incubating:0,exposedInfactious:0,latentlyInfactious:0,recovered:0,serious:0,susceptible:0},quarantined:{total:0,atHome:0,atHospital:0,confirmed:0,suspected:0},doctor:{available:0,dead:0,ill:0,total:0},datetime:Object(m.a)({},this.datetime),R0:0},e=this.individuals.filter((function(t){return t.treatmentState.isConfirmed}));t.R0=e.length?e.reduce((function(t,e){return t+(e.illRelation.to?e.illRelation.to.length:0)}),0)/e.length:0;var i=!0,a=!1,n=void 0;try{for(var r,l=this.individuals[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var o=r.value;o.isDoctor&&(t.doctor.total++,o.isDead&&t.doctor.dead++,o.illState>=T.incubating&&t.doctor.ill++,o.isWorking&&t.doctor.available++),t.population[T[o.illState]]+=1,o.isDead||(o.treatmentState.quanrantine===q.atHome&&(t.quarantined.total++,t.quarantined.atHome++),o.treatmentState.quanrantine===q.atHospital&&(t.quarantined.total++,t.quarantined.atHospital++),o.treatmentState.isConfirmed&&(t.quarantined.confirmed++,t.quarantined.suspected--),o.treatmentState.isSuspected&&t.quarantined.suspected++)}}catch(c){a=!0,n=c}finally{try{i||null==l.return||l.return()}finally{if(a)throw n}}for(var s in this.districts)t.districtDistribution[s]+=this.districts[s].population;return t}}]),t}(),rt=i(97),lt=i.n(rt),ot=(i(138),i(139),i(140),i(141),i(208)),st=i(207),ct=i(212);function ut(){var t=Object(h.a)(["\n    padding: 0 0.3rem;\n    margin: 0.2rem 0;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    span {\n        margin-right: 1rem;\n    }\n"]);return ut=function(){return t},t}var dt=y.a.div(ut()),ht={disease:{cureRate:"number",deadRate:"number",immuneRate:"number",infectiousRate:"number",name:"string",selfRecoverRate:"number",seriousRate:"number",toExposedInfactiousRate:"number",toLatentlyInfactiousRate:"number"},family:{partyRate:"number"},medicine:{confirmRate:"number",cureRateInHospital:"number",cureRateOnMedicalBed:"number",deteriorateFactorOnMedicalBed:"number",visitingHospitalRate:"number",doctorNum:"number",infactiousRateBetweenDoctorAndPatient:"number",infactiousRateBetweenPatients:"number",medicalBedNumber:"number"},individual:{goOutRateWhenQuarantedAtHome:"number",visitingHospitalRateWhenExposed:"number"},numberOfScenePerDay:"number",region:{densityOfPopulation:"number",doPeriodicPhysicalExamination:"number",facilityActiveRate:"number",privateCarRate:"number",unemploymentRate:"number"}},mt=function(t){var e=n.a.useState(!1),i=Object(x.a)(e,2),a=i[0],r=i[1],l=n.a.useState(JSON.parse(localStorage.getItem("world-param"))||X),o=Object(x.a)(l,2),s=o[0],c=o[1],u=n.a.useCallback((function(){r(!0)}),[]),d=n.a.useCallback((function(){r(!1)}),[]);function h(t){return function(e){return c(function(t,e,i){for(var a=Object.assign({},t),n=a,r="",l=0;l<e.length;l++)r=e[l],l!==e.length-1&&(n[r]=Object.assign({},n[r]),n=a[r]);return n[r]=i,a}(s,t,e))}}var m=n.a.useCallback((function(){t.setParams(s),localStorage.setItem("world-param",JSON.stringify(s)),d()}),[t,s,d]),f=[];for(var p in ht){var v=ht[p];for(var y in f.push(n.a.createElement("h3",null,p)),v){var g=v[y];if("number"===g){var b=s[p][y],w=0!==b?Math.floor(Math.log10(b)):0;f.push(n.a.createElement(dt,null,n.a.createElement("span",null,y),n.a.createElement(ot.a,{key:p+"-"+g,min:0,max:1e3,step:Math.pow(10,w),onChange:h([p,y]),defaultValue:b})))}else"string"===g&&f.push()}}return n.a.createElement("div",null,n.a.createElement(K.a,{onClick:u,style:{margin:"0.5rem "},icon:n.a.createElement(ct.a,null)},"Settings"),n.a.createElement(st.a,{title:"Setting",onOk:m,onCancel:d,visible:a},f),")")};function ft(){var t=Object(h.a)(["\n    position: absolute;\n    left: 1em;\n    top: 1em;\n    padding: 0.5em 1em;\n    background-color: rgba(10, 20, 90, 0.3);\n    border: 1px solid rgb(15, 30, 150);\n    color: #aae;\n    border-radius: 4px;\n    box-shadow: 0 6px 4px 4px rgba(0, 0, 0, 0.2);\n"]);return ft=function(){return t},t}var pt=f.G2.Global;pt.registerTheme("new",$),pt.setTheme("new");var vt=["00:00","9:30","18:00"],yt=y.a.div(ft()),gt=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).world=new nt(JSON.parse(localStorage.getItem("world-param"))||X),i.looping=!1,i.state=void 0,i.buffIndex=0,i.worldRef=void 0,i.playLoop=function(){if(i.looping){if(i.buffIndex>100)i.setState({data:i.world.aggData}),i.buffIndex=0;else{for(var t=0;t<10;t++)i.world.step();i.buffIndex+=10}setTimeout(i.playLoop,0)}},i.step=function(){i.pause(),i.world.step(),console.log(i.world.datetime),i.worldRef.current.step(),i.setState({data:i.world.aggData})},i.play=function(){i.start(),i.playLoop()},i.reset=function(){i.world=new nt(X),i.world.start(),i.setState({data:[]}),i.pause()},i.start=function(){i.setState({looping:!0}),i.looping=!0},i.pause=function(){i.setState({looping:!1}),i.looping=!1},i.setParam=function(t){i.world.param=t},i.state={data:[],looping:!1},i.world.start(),i.worldRef=n.a.createRef(),i}return Object(d.a)(e,t),Object(s.a)(e,[{key:"componentWillMount",value:function(){document.body.style.backgroundImage="url(".concat(lt.a,")")}},{key:"render",value:function(){var t={boxShadow:"3px 0px 2px 0px rgba(0, 0, 0, 0.2)",padding:"2em"},e=this.world.datetime;return n.a.createElement(V.a,{className:"main",justify:"center"},n.a.createElement(J.a,{xl:12,lg:24,style:t},n.a.createElement(L,{world:this.world,ref:this.worldRef}),n.a.createElement(V.a,null,this.state.looping?n.a.createElement(K.a,{onClick:this.pause,style:{margin:"0.5rem 0.5rem 0.5rem 0"},icon:n.a.createElement(G.a,null)},"Pause"):n.a.createElement(K.a,{onClick:this.play,style:{margin:"0.5rem 0.5rem 0.5rem 0"},icon:n.a.createElement(z.a,null)},"Play"),n.a.createElement(K.a,{onClick:this.step,style:{margin:"0.5rem"},icon:n.a.createElement(N.a,null)},"Step"),n.a.createElement(K.a,{onClick:this.reset,style:{margin:"0.5rem "},icon:n.a.createElement(Q.a,null)},"Reset"),n.a.createElement(mt,{setParams:this.setParam}))),n.a.createElement(J.a,{xl:4,lg:11,style:t},n.a.createElement(yt,null,"Day: ",e.day,n.a.createElement("br",null),"Time: ",vt[e.scene])),n.a.createElement(J.a,{xl:8,lg:11,style:t},n.a.createElement("div",{className:"charts"},n.a.createElement(S,{agg:this.state.data}),n.a.createElement(O,{agg:this.state.data}),n.a.createElement(A,{agg:this.state.data}),n.a.createElement(M,{agg:this.state.data}))))}}]),e}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(n.a.createElement(gt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},97:function(t,e,i){t.exports=i.p+"static/media/virus.a16df4b7.jpg"}},[[116,1,2]]]);
//# sourceMappingURL=main.787d0ee8.chunk.js.map